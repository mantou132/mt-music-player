!function(t){function e(e){for(var i,o,n=e[0],r=e[1],s=0,c=[];s<n.length;s++)o=n[s],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&c.push(a[o][0]),a[o]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);for(l&&l(e);c.length;)c.shift()()}var i={},a={0:0};function o(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(t){var e=[],i=a[t];if(0!==i)if(i)e.push(i[2]);else{var n=new Promise((function(e,o){i=a[t]=[e,o]}));e.push(i[2]=n);var r,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(t){return o.p+""+({}[t]||t)+"."+{1:"f63af56f06ff0b75b4bb"}[t]+".js"}(t);var l=new Error;r=function(e){s.onerror=s.onload=null,clearTimeout(c);var i=a[t];if(0!==i){if(i){var o=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+n+")",l.name="ChunkLoadError",l.type=o,l.request=n,i[1](l)}a[t]=void 0}};var c=setTimeout((function(){r({type:"timeout",target:s})}),12e4);s.onerror=s.onload=r,document.head.appendChild(s)}return Promise.all(e)},o.m=t,o.c=i,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o.oe=function(t){throw console.error(t),t};var n=window.webpackJsonp=window.webpackJsonp||[],r=n.push.bind(n);n.push=e,n=n.slice();for(var s=0;s<n.length;s++)e(n[s]);var l=r;o(o.s=1)}([function(t,e){const i=1e3;class a extends HTMLElement{constructor(){var t,e,a;super(),a=()=>{this.remove()},(e="end")in(t=this)?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a;const o=performance.now();o>i?this.end():setTimeout(this.end,i-o)}}customElements.define("app-splash",a)},function(t,e,i){"use strict";i.r(e);var a={};i.r(a),i.d(a,"userData",(function(){return xt})),i.d(a,"playerState",(function(){return St})),i.d(a,"audioState",(function(){return kt})),i.d(a,"toastState",(function(){return $t})),i.d(a,"selectorState",(function(){return Et})),i.d(a,"uploaderState",(function(){return Pt}));var o={};i.r(o),i.d(o,"modalState",(function(){return Ht})),i.d(o,"confirmState",(function(){return At})),i.d(o,"menuState",(function(){return Ot})),i.d(o,"drawerState",(function(){return Tt}));var n={};i.r(n),i.d(n,"songData",(function(){return Nt})),i.d(n,"searchData",(function(){return Lt})),i.d(n,"favoriteData",(function(){return It})),i.d(n,"artistData",(function(){return Mt})),i.d(n,"albumData",(function(){return zt})),i.d(n,"playlistData",(function(){return Ct}));const r=new WeakMap,s=t=>"function"==typeof t&&r.has(t),l=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,c=(t,e,i=null,a=null)=>{let o=e;for(;o!==i;){const e=o.nextSibling;t.insertBefore(o,a),o=e}},d=(t,e,i=null)=>{let a=e;for(;a!==i;){const e=a.nextSibling;t.removeChild(a),a=e}},p={},u={},h=`{{lit-${String(Math.random()).slice(2)}}}`,m=`\x3c!--${h}--\x3e`,f=new RegExp(`${h}|${m}`),g="$lit$";class b{constructor(t,e){this.parts=[],this.element=e;let i=-1,a=0;const o=[],n=e=>{const r=e.content,s=document.createTreeWalker(r,133,null,!1);let l=0;for(;s.nextNode();){i++;const e=s.currentNode;if(1===e.nodeType){if(e.hasAttributes()){const o=e.attributes;let n=0;for(let t=0;t<o.length;t++)o[t].value.indexOf(h)>=0&&n++;for(;n-- >0;){const o=t.strings[a],n=w.exec(o)[2],r=n.toLowerCase()+g,s=e.getAttribute(r).split(f);this.parts.push({type:"attribute",index:i,name:n,strings:s}),e.removeAttribute(r),a+=s.length-1}}"TEMPLATE"===e.tagName&&n(e)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(h)>=0){const n=e.parentNode,r=t.split(f),s=r.length-1;for(let t=0;t<s;t++)n.insertBefore(""===r[t]?v():document.createTextNode(r[t]),e),this.parts.push({type:"node",index:++i});""===r[s]?(n.insertBefore(v(),e),o.push(e)):e.data=r[s],a+=s}}else if(8===e.nodeType)if(e.data===h){const t=e.parentNode;null!==e.previousSibling&&i!==l||(i++,t.insertBefore(v(),e)),l=i,this.parts.push({type:"node",index:i}),null===e.nextSibling?e.data="":(o.push(e),i--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(h,t+1));)this.parts.push({type:"node",index:-1})}}};n(e);for(const t of o)t.parentNode.removeChild(t)}}const y=t=>-1!==t.index,v=()=>document.createComment(""),w=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F \x09\x0a\x0c\x0d"'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;class x{constructor(t,e,i){this._parts=[],this.template=t,this.processor=e,this.options=i}update(t){let e=0;for(const i of this._parts)void 0!==i&&i.setValue(t[e]),e++;for(const t of this._parts)void 0!==t&&t.commit()}_clone(){const t=l?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),e=this.template.parts;let i=0,a=0;const o=t=>{const n=document.createTreeWalker(t,133,null,!1);let r=n.nextNode();for(;i<e.length&&null!==r;){const t=e[i];if(y(t))if(a===t.index){if("node"===t.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(r.previousSibling),this._parts.push(t)}else this._parts.push(...this.processor.handleAttributeExpressions(r,t.name,t.strings,this.options));i++}else a++,"TEMPLATE"===r.nodeName&&o(r.content),r=n.nextNode();else this._parts.push(void 0),i++}};return o(t),l&&(document.adoptNode(t),customElements.upgrade(t)),t}}class S{constructor(t,e,i,a){this.strings=t,this.values=e,this.type=i,this.processor=a}getHTML(){const t=this.strings.length-1;let e="";for(let i=0;i<t;i++){const t=this.strings[i],a=w.exec(t);e+=a?t.substr(0,a.index)+a[1]+a[2]+g+a[3]+h:t+m}return e+this.strings[t]}getTemplateElement(){const t=document.createElement("template");return t.innerHTML=this.getHTML(),t}}const k=t=>null===t||!("object"==typeof t||"function"==typeof t);class ${constructor(t,e,i){this.dirty=!0,this.element=t,this.name=e,this.strings=i,this.parts=[];for(let t=0;t<i.length-1;t++)this.parts[t]=this._createPart()}_createPart(){return new E(this)}_getValue(){const t=this.strings,e=t.length-1;let i="";for(let a=0;a<e;a++){i+=t[a];const e=this.parts[a];if(void 0!==e){const t=e.value;if(null!=t&&(Array.isArray(t)||"string"!=typeof t&&t[Symbol.iterator]))for(const e of t)i+="string"==typeof e?e:String(e);else i+="string"==typeof t?t:String(t)}}return i+=t[e]}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class E{constructor(t){this.value=void 0,this.committer=t}setValue(t){t===p||k(t)&&t===this.value||(this.value=t,s(t)||(this.committer.dirty=!0))}commit(){for(;s(this.value);){const t=this.value;this.value=p,t(this)}this.value!==p&&this.committer.commit()}}class P{constructor(t){this.value=void 0,this._pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(v()),this.endNode=t.appendChild(v())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t._insert(this.startNode=v()),t._insert(this.endNode=v())}insertAfterPart(t){t._insert(this.startNode=v()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this._pendingValue=t}commit(){for(;s(this._pendingValue);){const t=this._pendingValue;this._pendingValue=p,t(this)}const t=this._pendingValue;t!==p&&(k(t)?t!==this.value&&this._commitText(t):t instanceof S?this._commitTemplateResult(t):t instanceof Node?this._commitNode(t):Array.isArray(t)||t[Symbol.iterator]?this._commitIterable(t):t===u?(this.value=u,this.clear()):this._commitText(t))}_insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}_commitNode(t){this.value!==t&&(this.clear(),this._insert(t),this.value=t)}_commitText(t){const e=this.startNode.nextSibling;t=null==t?"":t,e===this.endNode.previousSibling&&3===e.nodeType?e.data=t:this._commitNode(document.createTextNode("string"==typeof t?t:String(t))),this.value=t}_commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof x&&this.value.template===e)this.value.update(t.values);else{const i=new x(e,t.processor,this.options),a=i._clone();i.update(t.values),this._commitNode(a),this.value=i}}_commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let i,a=0;for(const o of t)void 0===(i=e[a])&&(i=new P(this.options),e.push(i),0===a?i.appendIntoPart(this):i.insertAfterPart(e[a-1])),i.setValue(o),i.commit(),a++;a<e.length&&(e.length=a,this.clear(i&&i.endNode))}clear(t=this.startNode){d(this.startNode.parentNode,t.nextSibling,this.endNode)}}class H{constructor(t,e,i){if(this.value=void 0,this._pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=i}setValue(t){this._pendingValue=t}commit(){for(;s(this._pendingValue);){const t=this._pendingValue;this._pendingValue=p,t(this)}if(this._pendingValue===p)return;const t=!!this._pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)),this.value=t,this._pendingValue=p}}class A extends ${constructor(t,e,i){super(t,e,i),this.single=2===i.length&&""===i[0]&&""===i[1]}_createPart(){return new O(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class O extends E{}let T=!1;try{const t={get capture(){return T=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}class N{constructor(t,e,i){this.value=void 0,this._pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=i,this._boundHandleEvent=t=>this.handleEvent(t)}setValue(t){this._pendingValue=t}commit(){for(;s(this._pendingValue);){const t=this._pendingValue;this._pendingValue=p,t(this)}if(this._pendingValue===p)return;const t=this._pendingValue,e=this.value,i=null==t||null!=e&&(t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive),a=null!=t&&(null==e||i);i&&this.element.removeEventListener(this.eventName,this._boundHandleEvent,this._options),a&&(this._options=L(t),this.element.addEventListener(this.eventName,this._boundHandleEvent,this._options)),this.value=t,this._pendingValue=p}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const L=t=>t&&(T?{capture:t.capture,passive:t.passive,once:t.once}:t.capture);const I=new class{handleAttributeExpressions(t,e,i,a){const o=e[0];if("."===o){return new A(t,e.slice(1),i).parts}return"@"===o?[new N(t,e.slice(1),a.eventContext)]:"?"===o?[new H(t,e.slice(1),i)]:new $(t,e,i).parts}handleTextExpression(t){return new P(t)}};function M(t){let e=z.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},z.set(t.type,e));let i=e.stringsArray.get(t.strings);if(void 0!==i)return i;const a=t.strings.join(h);return void 0===(i=e.keyString.get(a))&&(i=new b(t,t.getTemplateElement()),e.keyString.set(a,i)),e.stringsArray.set(t.strings,i),i}const z=new Map,C=new WeakMap,D=(t,e,i)=>{let a=C.get(e);void 0===a&&(d(e,e.firstChild),C.set(e,a=new P(Object.assign({templateFactory:M},i))),a.appendInto(e)),a.setValue(t),a.commit()};(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.0.0");const j=(t,...e)=>new S(t,e,"html",I),R={HOVER:"(hover: hover)",get isHover(){return window.matchMedia(this.HOVER).matches},PHONE:"(min-width: 320px) and (max-width: 480px)",get isPhone(){return window.matchMedia(this.PHONE).matches},LAPTOP:"(min-width: 1025px) and (max-width: 1280px) and (orientation: landscape)",get isLaptop(){return window.matchMedia(this.LAPTOP).matches},DESKTOP:"(min-width: 1281px) and (orientation: landscape)",get isDesktop(){return window.matchMedia(this.DESKTOP).matches},PHONE_LANDSCAPE:"(min-width: 481px) and (max-width: 767px) and (orientation: landscape)",get isPhoneLandscape(){return window.matchMedia(this.PHONE_LANDSCAPE).matches},TABLET:"(min-width: 768px) and (max-width: 1024px)",get isTablet(){return window.matchMedia(this.Tablet).matches},SMALL_PHONE:"(min-width: 320px) and (max-width: 480px) and (max-height: 640px)",get isSmallPhone(){return window.matchMedia(this.SMALL_PHONE).matches},WATCH:"(max-width: 319px)",get isWatch(){return window.matchMedia(this.WATCH).matches},SHORT:"(min-width: 480px) and (max-height: 320px)",get isShort(){return window.matchMedia(this.SHORT).matches},PWA:"(display-mode: standalone)",get isPWA(){return window.matchMedia(this.PWA).matches},MOTION_REDUCE:"(prefers-reduced-motion: reduce)",get isMotionReduce(){return window.matchMedia(this.MOTION_REDUCE).matches}};window.mediaQuery=R;var _,U,V,q,W,B=R;customElements.define("app-theme",class extends HTMLElement{constructor(){super(),D(j`<style>:root{--safe-width:calc(
                100% - env(safe-area-inset-left) - env(safe-area-inset-right)
              );--safe-height:calc(
                100% - env(safe-area-inset-top) - env(safe-area-inset-bottom)
              );--scrollbar-track-color:rgba(0, 0, 0, 0.2);--scrollbar-color:rgba(255, 255, 255, 0.2);--theme-background-color:#20272b;--theme-color:#18d150;--theme-error-color:red;--theme-backdrop-color:rgba(0, 0, 0, 0.6);--drawer-width:22rem;--drawer-user-background-color:transparent;--drawer-user-text-color:#fff;--drawer-background-color:rgba(0, 0, 0, 0.25);--drawer-text-primary-color:#fff;--drawer-text-secondary-color:#707070;--action-background-color:transparent;--action-text-color:inherit;--list-padding:5.6rem;--list-background-color:#263238;--list-background-light-color:#34434a;--list-hover-background-color:#0002;--list-text-primary-color:#fff;--list-text-secondary-color:#707070;--notfound-text-primary-color:#fff;--notfound-text-secondary-color:#707070;--player-height:calc(9rem + env(safe-area-inset-bottom));--player-background-color:#20272b;--player-separator-color:black;--player-text-primary-color:#fff;--player-text-secondary-color:#707070;--player-cover-box-shadow:0px 1px 3px #0007;--toast-background-color:#20272b;--toast-text-color:#fff;--toast-border-color:#000;--menu-background-color:#20272b;--menu-hover-background-color:#263238;--menu-text-color:#c3c3c3;--menu-hover-text-color:#fff;--menu-box-shadow:0 8px 24px rgba(0, 0, 0, 0.2);--modal-margin:2.4rem;--modal-background-color:#fff;--modal-text-primary-color:#000;--modal-text-secondary-color:#707070;--modal-box-shadow:0px 9px 13px #0007;--form-background-color:#fff;--form-hover-background-color:#0001;--form-text-primary-color:#000;--form-text-secondary-color:#707070;--form-text-disabled-color:#c3c3c3}@media ${B.PHONE_LANDSCAPE},${B.PHONE},${B.TABLET}{:root{--drawer-background-color:rgba(0, 0, 0, 0.75);--list-padding:1.6rem}}@media ${B.PHONE}{:root{--drawer-width:30.4rem;--drawer-user-background-color:#20272b;--drawer-user-text-color:#fff;--drawer-background-color:#fff;--drawer-text-primary-color:#fff;--drawer-text-secondary-color:#000;--action-background-color:#20272b;--action-text-color:#fff;--action-border-color:#eee;--action-box-shadow:0 -4px 4px 4px rgba(0, 0, 0, 0.4);--list-padding:0;--list-background-color:#fff;--list-background-light-color:#fff;--list-hover-background-color:#fff;--list-text-primary-color:#000;--notfound-text-primary-color:#000;--notfound-text-secondary-color:#c3c3c3;--menu-background-color:#fff;--menu-hover-background-color:#eee;--menu-text-color:#000;--menu-hover-text-color:#000;--player-height:calc(5.6rem + env(safe-area-inset-bottom))}}@media ${B.WATCH},${B.SHORT}{:root{--player-height:100%}}</style>`,this)}}),customElements.define("app-icon",(U=_=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const t=this.getAttribute("name"),e=document.querySelector(`#icon-${t}`);D(j`<style>:host{position:relative;width:2.4rem;height:2.4rem}:host(:not([hidden])){display:inline-block}</style>${e.cloneNode(!0).content}<slot></slot>`,this.shadowRoot)}attributeChangedCallback(t,e,i){this.isConnected&&e!==i&&"name"===t&&this.connectedCallback()}},W=["name"],(q="observedAttributes")in(V=_)?Object.defineProperty(V,q,{value:W,enumerable:!0,configurable:!0,writable:!0}):V[q]=W,U));const F=Symbol("key: get store module"),Y=Symbol("key: get store module key"),K=Symbol("function mark"),X=Symbol("handles key"),G=t=>{const e=new Proxy(t,{has:(t,e)=>e in t,get:(t,e)=>t[e],set:(t,e,i)=>(t[e]=i,t[e][X].get(e).forEach(t=>t[K].has(e)&&t(i)),!0)});return Object.keys(t).forEach(i=>{const a=t[i];a[F]=a,a[Y]=i,a[X]=new Map([[i,new Set]]),e[i]=a}),e},J=new Set,Q=(t,e)=>{J.size||queueMicrotask(()=>{J.forEach(t=>t(e)),J.clear()});const i=t[Y];Object.assign(t[F],e),t[X].get(i).forEach(t=>{t[K].has(i)&&J.add(t)})},Z=(t,e)=>{const i=t[Y],a=t[X].get(i);e[K]||(e[K]=new Set),e[K].add(i),a.add(e)},tt=(t,e)=>{const i=t[Y];t[X].get(i).delete(e)};var et={api:`${window.location.host}/api`,storage:"mt-music-storage.xianqiao.wang"};function it(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}async function at(t,e=2){return(await async function(t){const{default:e}=await i.e(1).then(i.bind(null,2)),a=e(t,{style:e.STYLE_INITIALS}).flat();return a.length<2?a.join(""):a.map(t=>t.substr(0,1)).join("")}(t)).substr(0,e).toUpperCase()}function ot(t){return t?String(t).match(/^(\/\/|https?:|blob:|data:)/)?t:`//${et.storage}/${t}`:""}function nt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const rt=new class{constructor(){it(this,"currentId",0),it(this,"count",0),it(this,"pool",new Map)}add(t){this.pool.set(this.count,t),this.count+=1}get(){const t=this.pool.get(this.currentId);return t&&(this.pool.delete(this.currentId),this.currentId+=1),t}},st=()=>window.requestAnimationFrame((function t(e){const i=rt.get();i&&(i(),performance.now()-e<16)?t(e):st()}));st();const lt=Symbol("mounted"),ct=Symbol("connectedStorePages");class dt extends HTMLElement{constructor(){super(),this[ct]=new Set,this.state={},this.setState=this.setState.bind(this),this.willMount=this.willMount.bind(this),this.render=this.render.bind(this),this.mounted=this.mounted.bind(this),this.shouldUpdate=this.shouldUpdate.bind(this),this.update=this.update.bind(this),this.updated=this.updated.bind(this),this.connectStores=this.connectStores.bind(this),this.disconnectStores=this.disconnectStores.bind(this),this.attributeChanged=this.attributeChanged.bind(this),this.unmounted=this.unmounted.bind(this);const{observedPropertys:t,observedStores:e}=this.constructor;t&&t.forEach(t=>{let e;Object.defineProperty(this,t,{get:()=>e,set(t){t!==e&&(e=t,this.update())}})}),e&&e.forEach(t=>{if(!t[Y])throw new Error("`observedStores` only support store module");Z(t,this.update),this[ct].add(t)}),this.attachShadow({mode:"open"})}setState(t){this.state=function t(e,i,a){const o=a||e;return new Set(Object.keys(e).concat(Object.keys(i))).forEach(a=>{a in e?a in i?i[a]&&i[a].constructor===Object?o[a]=t(e[a],i[a]):o[a]=i[a]:o[a]=e[a]:o[a]=i[a]}),o}(this.state,t),this.update()}willMount(){}render(){return j``}mounted(){}shouldUpdate(){return!0}update(){this.shouldUpdate()&&(D(this.render(),this.shadowRoot),this.updated())}updated(){}connectStores(t){t.forEach(t=>{Z(t,this.update),this[ct].add(t)})}disconnectStores(t){t.forEach(t=>{tt(t,this.update)})}attributeChanged(){}unmounted(){}connectedCallback(){this.willMount(),D(this.render(),this.shadowRoot),this.mounted(),this[lt]=!0}attributeChangedCallback(...t){this[lt]&&(this.attributeChanged(...t),this.update())}disconnectedCallback(){this[ct].forEach(t=>{tt(t,this.update)}),this.unmounted(),this[lt]=!1}}nt(dt,"observedAttributes",void 0),nt(dt,"observedPropertys",void 0),nt(dt,"observedStores",void 0);class pt extends dt{constructor(){if(super(),this.constructor.instance)throw new Error("multiple instances are not allowed");this.constructor.instance=this}}nt(pt,"instance",void 0);class ut extends dt{update(){rt.add(()=>{this.shouldUpdate()&&(D(this.render(),this.shadowRoot),this.updated())})}connectedCallback(){this.willMount(),rt.add(()=>{D(this.render(),this.shadowRoot),this.mounted(),this[lt]=!0})}}const ht={localStorage:{},sessionStorage:{}};var mt={get(t,e){if(ht[e][t])return ht[e][t];let i=window[e].getItem(t);if(i){try{i=JSON.parse(i)}catch(e){localStorage.removeItem(t),i=void 0}return i}},getLocal(t){return this.get(t,"localStorage")},getSession(t){return this.get(t,"sessionStorage")},set:(t,e,i)=>(delete ht[i][t],window[i].setItem(t,JSON.stringify(e))),setLocal(t,e){return this.set(t,e,"localStorage")},setSession(t,e){return this.set(t,e,"sessionStorage")}};class ft extends URLSearchParams{constructor(t){if(t instanceof ft)return t;"string"==typeof t?super(t):(super(),Object.keys(t).forEach(e=>{this.append(e,t[e])}))}concat(t){let e;e="string"==typeof t?new URLSearchParams(t):t,Object.keys(e).forEach(t=>{this.append(t,e[t])})}toString(){const t=super.toString();return t?`?${t}`:""}toJSON(){return this.toString()}}const gt=new WeakMap;function bt(t,e){if(t.$key)throw new Error("`$key` is not allowed");if(t.$close)throw new Error("`$close` is not allowed");const i={...t,$key:Date.now()+performance.now(),$close:!!e};return gt.set(i,e),i}const yt=G({historyState:{list:[],currentIndex:-1}}),vt={historyState:yt.historyState,basePath:"",get location(){const{list:t,currentIndex:e}=yt.historyState,i=t[e],a=new ft(i.query);return{path:i.path,query:a,state:i.state,title:i.title,href:i.path+a}},forward(){window.history.forward()},back(){window.history.back()},push(t){const{path:e,close:i}=t,a=t.query||"",o=t.title||"",n=bt(t.data||{},i);window.history.pushState(n,o,vt.basePath+e+new ft(a));const{list:r,currentIndex:s}=yt.historyState,l=r.slice(0,s+1).concat({state:n,title:o,path:e,query:a});Q(yt.historyState,{list:l,currentIndex:l.length-1})},pushState(t){const{path:e,query:i}=vt.location;vt.push({path:e,query:i,...t})},replace(t){const{path:e,close:i}=t,a=t.query||"",o=t.data||{},n=t.title||"",r=bt(o,i);window.history.replaceState(r,n,vt.basePath+e+new ft(a));const{list:s,currentIndex:l}=yt.historyState;s.splice(l,1,{state:r,title:n,path:e,query:a}),Q(yt.historyState,{list:s})},replaceState(t){const{path:e,query:i}=vt.location;vt.replace({path:e,query:i,...t})}};if(window.history.state)window.history.state.$close&&vt.back();else{const{pathname:t,search:e}=window.location;vt.push({path:t,query:e})}Q(yt.historyState,mt.getSession("historyState")),window.addEventListener("unload",()=>{mt.setSession("historyState",yt.historyState)}),window.addEventListener("popstate",t=>{const{list:e,currentIndex:i}=yt.historyState;if(null===t.state){const{state:t,title:i,path:a,query:o}=e[0];return void window.history.pushState(t,i,vt.basePath+a+new ft(o))}const{state:a}=e[i],o=e.findIndex(e=>e.state.$key===t.state.$key);if(a.$close){const t=gt.get(a);t&&t()}Q(yt.historyState,{currentIndex:o})});var wt=vt;window._history=vt;const xt={name:"",avatar:"",key:""},St={pip:null,maximize:!1,errorList:[],currentSong:null,state:"paused",volume:.1,muted:!1,shuffle:!1,mode:"repeat"},kt={currentTime:0,duration:180},$t={type:"info",text:null},Et={type:"",list:[]},Pt={list:[],errorList:[]},Ht={isOpen:!1,title:"",complete:"ok",cancel:"cancel",template:"",onclose:null,oncomplete:null,oncancel:null},At={isOpen:!1,title:"",complete:"confirm",cancel:"cancel",text:"",oncomplete:null,oncancel:null},Ot={isOpen:!1,type:"",target:null,stage:document.body,list:[],onclose:null},Tt={isOpen:!1},Nt={list:[]},Lt={text:"",list:[]},It={list:[]},Mt={list:[]},zt={list:[]},Ct={list:[]},Dt=G({...a,...o,...n});async function jt(t,e={}){Dt.userData.key&&(e.headers={...e.headers,"x-user":Dt.userData.key}),!e.body||e.body instanceof FormData||"object"!=typeof e.body||(e.body=JSON.stringify(e.body),e.headers={...e.headers,"content-type":"application/json"});const i=await fetch(`//${et.api}${t}`,e);return await i.json()}window._store=Dt;class Rt extends Map{get(t){return super.get(t)||{}}setList(t=[]){t.forEach(t=>{this.set(t.id,t)})}}const _t=new Rt,Ut=new Rt,Vt=async()=>{const t=await jt("/songs");return Q(Dt.songData,{list:t.map(t=>(_t.set(t.id,t),t.id))}),t},qt=async()=>{await Vt();const t=[];return _t.forEach(({star:e,id:i})=>{e&&t.push(i)}),Q(Dt.favoriteData,{list:t}),t},Wt=t=>{const e=Array.from(t);Q(Dt.uploaderState,{list:Dt.uploaderState.list.concat(e.map(t=>({file:t}))),errorList:[]}),e.forEach(async t=>{const e=new FormData;let i,a;e.append("file",t);try{a=await jt("/songs",{method:"post",body:e})}catch(t){i=!0}const{list:o,errorList:n}=Dt.uploaderState,r=o.findIndex(({file:e})=>t===e),s=o.splice(r,1);i?Q(Dt.uploaderState,{list:o,errorList:n.concat(s)}):(Q(Dt.uploaderState,{list:o}),_t.set(a.id,a),Q(Dt.songData,{list:[a.id].concat(Dt.songData.list)}))})},Bt=async(t,e)=>{const{currentSong:i}=Dt.playerState,a=await jt(`/songs/${t}`,{method:"put",body:e});Object.assign(_t.get(t),a,{picture:a.picture||void 0}),Q(Dt.songData,{}),i===t&&Q(Dt.playerState,{}),"star"in e&&Q(Dt.favoriteData,{list:await qt()})},Ft=async t=>{const e=await jt(`/search${new ft({q:t,type:"song"})}`);Q(Dt.searchData,{list:e.map(t=>(_t.set(t.id,t),t.id)),text:t}),wt.replace({path:wt.location.path,query:new ft({q:t})})};function Yt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Kt extends pt{constructor(...t){super(...t),Yt(this,"changeHandle",()=>{const t=this.shadowRoot.querySelector("input");Wt(t.files),t.value=""})}static open(){Kt.instance.shadowRoot.querySelector("input").click()}render(){return j`<style>:host{display:none}</style><input @change="${this.changeHandle}" type="file" multiple=multiple accept="audio/*">`}}Yt(Kt,"observedStores",[Dt.playerState]),customElements.define("app-upload",Kt);const Xt=async()=>{const t=await jt("/playlist");return Q(Dt.playlistData,{list:t.map(t=>(Ut.set(t.id,t),t.id))}),t},Gt=async(t,e)=>{const{list:i=[]}=Ut.get(t);await jt(`/playlist/${t}/songs/${e}`,{method:"post"}),i.unshift(e),Q(Dt.playlistData,{})},Jt=async t=>{const{list:e}=Dt.playlistData,i=await jt("/playlist",{method:"post",body:t});return Ut.set(i.id,i),Q(Dt.playlistData,{list:[i.id].concat(e)}),i};var Qt,Zt;function te(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}customElements.define("modal-body",(Zt=Qt=class extends dt{render(){const{template:t}=Dt.modalState;return j`<style>@media ${B.PHONE}{:host::-webkit-scrollbar{width:0}:host{scrollbar-width:none}}</style>${t}`}},function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(Qt,"observedStores",[Dt.modalState]),Zt));const ee=Object.assign({},Dt.modalState);class ie extends pt{constructor(...t){super(...t),te(this,"okHandle",async()=>{const{oncomplete:t}=Dt.modalState;try{t&&await t(),ie.close(),wt.back()}catch(t){}}),te(this,"cancelHandle",()=>{const{oncancel:t}=Dt.modalState;t&&t(),ie.close(),wt.back()}),te(this,"closeHandle",()=>{const{onclose:t}=Dt.modalState;t&&t(),wt.back()})}static open(t){Q(Dt.modalState,{...ee,...t,isOpen:!0}),wt.pushState({close:ie.close})}static close(){Q(Dt.modalState,{isOpen:!1})}render(){const{title:t,complete:e,cancel:i}=Dt.modalState;return j`<style>:host{z-index:8;position:fixed;top:0;left:0;display:flex;justify-content:center;align-items:center;width:100%;height:100%;opacity:0;pointer-events:none;transform:translateY(30%)}:host(.open){opacity:1;pointer-events:auto;transform:translateY(0)}.backdrop{position:absolute;top:0;left:0;width:100%;height:100%}.modal{flex-shrink:1;position:absolute;width:45rem;padding:var(--modal-margin);border-radius:2px;background:var(--modal-background-color);color:var(--modal-text-primary-color);fill:var(--modal-text-primary-color);box-shadow:var(--modal-box-shadow);overflow:auto}.titlebar{display:flex;align-items:center;flex-shrink:0}.complete{display:none}.title{flex-grow:1;margin:0;padding:0;font-size:2rem;font-weight:500;text-transform:capitalize}.close{color:var(--modal-text-secondary-color);fill:var(--modal-text-secondary-color)}modal-body{display:block;padding:2.4rem 0}.footer{display:flex;justify-content:flex-end;flex-shrink:0}.footer form-button:not(:last-of-type){margin-right:.8rem}@media ${B.PHONE}{:host{transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.backdrop{background:var(--theme-backdrop-color)}.modal{display:flex;flex-direction:column;height:100%;width:100%;padding:0;border-radius:0}.titlebar{border-bottom:1px solid var(--action-border-color);padding-top:env(safe-area-inset-top)}.title{padding-left:1.6rem}.close{padding:1.6rem;color:inherit;fill:inherit}modal-body{flex-grow:1;padding:1.6rem;overflow:auto}.footer{padding:.8rem 1.6rem}}@media ${B.PHONE} and ${B.PWA}{.titlebar{z-index:4;position:-webkit-sticky;position:sticky;top:0;flex-direction:row-reverse;border-bottom:none;background:var(--action-background-color);color:var(--action-text-color);fill:var(--action-text-color);box-shadow:var(--action-box-shadow)}.complete{display:block;padding:1.6rem;font-size:1.4rem;font-weight:500;text-transform:uppercase}.footer{display:none}}</style><div class="backdrop"></div><div class="modal"><div class="titlebar"><div class="complete" @click="${this.okHandle}" ?hidden="${!e}">${e}</div><h1 class="title">${t}</h1><app-icon name="clear" class="close" @click="${this.closeHandle}"><app-ripple circle color="rgba(0,0,0,0.54)"></app-ripple></app-icon></div><modal-body></modal-body><div class="footer"><form-button @click="${this.cancelHandle}" ?hidden="${!i}" type="secondary">${i}</form-button><form-button @click="${this.okHandle}" ?hidden="${!e}">${e}</form-button></div></div>`}mounted(){this.hidden=!1}updated(){const{isOpen:t}=Dt.modalState;t?this.classList.add("open"):this.classList.remove("open")}}function ae(){const t=document.createElement("app-form");D(j`<form-text label="title" name="title" required pattern=".*\\S.*"></form-text>`,t);return{title:"add playlist",complete:"save",cancel:"cancel",template:t,oncomplete:async()=>{if(!t.valid())throw new Error("Failed validation");Jt(t.value)}}}te(ie,"observedStores",[Dt.modalState]),customElements.define("app-modal",ie);var oe={HOME:{path:"/",title:"MT Music Player"},SONGS:{path:"/songs",title:"songs",getSubPageTitle:(t,e)=>`${t} - ${e}`},PLAYLIST:{path:"/playlist",title:"playlist"},FAVORITES:{path:"/favorites",title:"favorites"},SEARCH:{path:"/search",title:"search"},ALBUMS:{path:"/albums",title:"albums",subTitle:"album"},ARTISTS:{path:"/artists",title:"artists",subTitle:"artist"},PLAYLISTS:{path:"/playlists",title:"playlists",getSubPageTitle:t=>`playlist - ${t}`},404:{title:"not found"}};const ne=[{path:oe.ALBUMS.path,icon:"album",text:oe.ALBUMS.title},{path:oe.ARTISTS.path,icon:"person",text:oe.ARTISTS.title},{path:oe.SONGS.path,icon:"music-note",text:oe.SONGS.title},{path:oe.FAVORITES.path,icon:"star",text:oe.FAVORITES.title},{path:oe.PLAYLISTS.path,icon:"playlist-play",text:oe.PLAYLISTS.title}];class re extends pt{static open(){Q(Dt.drawerState,{isOpen:!0}),wt.pushState({close:re.close})}static close(){Q(Dt.drawerState,{isOpen:!1})}static closeHandle(){re.close(),wt.back()}static renderItem({path:t,icon:e,text:i}){return j`<li><app-link path="${t}" title="${i}"><app-icon name="${e}"></app-icon><span>${i}</span><app-ripple type="${B.isPhone?"touch":""}"></app-ripple></app-link></li>`}static renderPlaylist(t){const{title:e}=Ut.get(t);return j`<li><app-link path="${oe.PLAYLIST.path}" query="?id=${t}" title="${e}"><span>${e||"<empty name>"}</span><app-ripple type="${B.isPhone?"touch":""}"></app-ripple></app-link></li>`}static addPlaylistHandle(){ie.open(ae())}render(){const{name:t,avatar:e}=Dt.userData,{list:i}=Dt.playlistData;return j`<style>:host{position:fixed;top:0;left:0;width:var(--drawer-width);height:calc(100% - var(--player-height));font-size:1.4rem;background:var(--drawer-background-color);overflow:auto;scrollbar-width:thin;scrollbar-color:var(--scrollbar-color) var(--scrollbar-track-color)}.menu{box-sizing:border-box;height:100%;padding-bottom:env(safe-area-inset-bottom)}.user{position:relative;display:flex;align-items:center;padding:calc(4.8rem + env(safe-area-inset-top)) 2.4rem 2.4rem;background:var(--drawer-user-background-color);color:var(--drawer-user-text-color)}.avatar{margin:0 1.6rem 0 0;border-radius:100%;width:3.2rem}ol{margin:0;padding:0;margin-bottom:3.2rem;list-style:none;color:var(--drawer-text-secondary-color);fill:var(--drawer-text-secondary-color)}.default{font-weight:700}.default app-icon{display:none}.playlist{display:none}li{position:relative;display:flex;align-items:center;padding:1.6rem 2.4rem;text-transform:capitalize}li app-icon{margin-right:1.6rem}[active]{color:var(--theme-color);fill:var(--theme-color)}@media ${B.HOVER}{app-link:hover:not([active]){color:var(--drawer-text-primary-color)}li{cursor:pointer}}@media ${B.DESKTOP}{.playlist{display:block}}@media ${B.PHONE_LANDSCAPE},${B.PHONE},${B.TABLET}{:host{z-index:9;left:-100%;right:100%;width:100%;height:100%;transition-property:left;transition-delay:.2s;background:0 0;overflow:hidden}.backdrop{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;background:var(--theme-backdrop-color)}.menu{position:relative;width:var(--drawer-width);transform:translateX(-100%);background:var(--drawer-background-color);overflow:auto}.menu::-webkit-scrollbar{width:0}.menu{scrollbar-width:none}.backdrop,.menu{transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1);pointer-events:none}.user{flex-direction:column;align-items:flex-start;margin-bottom:1.6rem}.avatar{margin:0 0 1.6rem 0}.default{font-weight:400}.default app-icon{display:block}:host(.open){left:0;transition:none}:host(.open) .menu{transform:translateX(0)}:host(.open) .backdrop{opacity:1}:host(.open) .backdrop,:host(.open) .menu{pointer-events:auto}}</style><div class="backdrop" @click="${re.closeHandle}"></div><div class="menu"><div class="user"><app-img class="avatar" data-alt="avatar" data-src="${e}"></app-img><div>${t||"Login"}</div></div><ol class="default">${ne.map(re.renderItem)}</ol>${B.isDesktop?j`
              <ol class="playlist">
                ${i.map(re.renderPlaylist)}
              </ol>
              <ol class="playlist">
                <li @click="${re.addPlaylistHandle}">
                  <app-icon name="playlist-add"></app-icon>
                  <span>add playlisy</span>
                  <app-ripple></app-ripple>
                </li>
              </ol>
            `:""}</div>`}mounted(){Xt()}updated(){const{isOpen:t}=Dt.drawerState;t?this.classList.add("open"):this.classList.remove("open")}}function se(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(re,"observedStores",[Dt.drawerState,Dt.userData,Dt.playlistData]),customElements.define("app-drawer",re);class le extends dt{getContents(){return this.actions.map(t=>{switch(t){case le.TITLE:return j`<app-title class="title"></app-title>`;case le.UPLOAD:return j`<app-icon @click="${Kt.open}" name="add"><app-ripple scale=".8" circle></app-ripple></app-icon>`;case le.SEARCH:return j`<app-link path="${oe.SEARCH.path}"><app-icon name="search"><app-ripple scale=".8" circle></app-ripple></app-icon></app-link>`;case le.BACK:return j`<app-link path="${oe.HOME.path}" title="back"><app-icon name="arrow-back"><app-ripple scale=".8" circle></app-ripple></app-icon></app-link>`;case le.ADD_PLAYLIST:return j`<app-icon name="playlist-add" @click="${()=>ie.open(ae())}"><app-ripple scale=".8" circle></app-ripple></app-icon>`;case le.MENU:return j`<app-icon @click="${re.open}" name="menu"><app-ripple scale=".8" circle></app-ripple></app-icon>`;case le.SEARCH_INPUT:return function(){const{query:t}=wt.location;return j`<form-text class="input" value="${t.get("q")||Dt.searchData.text}" autofocus @change="${({detail:t})=>Ft(t)}"></form-text>`}();default:return""}})}render(){return this.actions.length?j`<style>:host{flex-shrink:0;display:flex;align-items:center;padding:calc(1.6rem + env(safe-area-inset-top)) 1.6rem 1.6rem}.title{display:none}.contents{display:contents}.contents app-icon{margin-right:1.6rem}@media ${B.LAPTOP},${B.DESKTOP}{app-icon[name=menu]{display:none}}@media ${B.PHONE} and ${B.PWA}{:host{z-index:4;position:-webkit-sticky;position:sticky;top:0;padding:calc(.4rem + env(safe-area-inset-top)) .4rem .4rem;background:var(--action-background-color);color:var(--action-text-color);fill:var(--action-text-color);box-shadow:var(--action-box-shadow)}.title{flex-grow:1;display:block;margin:0;padding:0 1.2rem;font-size:2rem;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.contents app-icon{padding:1.2rem;margin-right:0}.input{padding-right:1.2rem}}</style><div class="contents">${this.getContents()}</div>`:j``}}function ce(t){return t.replace(/^\w/,t=>t.toUpperCase())}function de(t){return t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function pe(t){return Object.keys(t).reduce((e,i)=>t[i]?`${e}${e?" ":""}${de(i)}`:e,"")}function ue(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}se(le,"TITLE",Symbol("title")),se(le,"UPLOAD",Symbol("upload")),se(le,"SEARCH",Symbol("search")),se(le,"BACK",Symbol("back")),se(le,"ADD_PLAYLIST",Symbol("add playlist")),se(le,"MENU",Symbol("menu")),se(le,"SEARCH_INPUT",Symbol("search input")),se(le,"observedPropertys",["actions"]),se(le,"observedStores",[Dt.selectorState]),customElements.define("app-action",le);const he=Object.assign({},Dt.confirmState);class me extends pt{constructor(...t){super(...t),ue(this,"okHandle",()=>{const{oncomplete:t}=Dt.confirmState;t&&t(),me.close(),wt.back()}),ue(this,"cancelHandle",()=>{const{oncancel:t}=Dt.confirmState;t&&t(),me.close(),wt.back()})}static open(t){Q(Dt.confirmState,{...he,...t,isOpen:!0}),wt.pushState({title:t.title,close:me.close})}static close(){Q(Dt.confirmState,{isOpen:!1})}render(){const{title:t,complete:e,cancel:i,text:a}=Dt.confirmState;return j`<style>:host{z-index:10;position:fixed;top:0;left:0;display:flex;justify-content:center;align-items:center;width:100%;height:100%;opacity:0;pointer-events:none}:host(.open){opacity:1;pointer-events:auto}.backdrop{position:absolute;top:0;left:0;width:100%;height:100%}.warp{flex-shrink:1;position:absolute;width:28rem;padding:1.6rem;border-radius:.2rem;background:var(--modal-background-color);color:var(--modal-text-primary-color);fill:var(--modal-text-primary-color);box-shadow:var(--modal-box-shadow);overflow:auto}.title{flex-grow:1;margin:0 0 1.4rem;padding:0;font-size:2rem;font-weight:500;text-transform:capitalize}.body{min-height:4em;margin-bottom:1em}.footer{display:flex;flex-direction:row-reverse}@media ${B.PHONE}{:host{transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1)}.backdrop{background:var(--theme-backdrop-color)}}</style><div class="backdrop"></div><div class="warp"><h1 class="title" ?hidden="${!t}">${t}</h1><div class="body">${ce(a)}</div><div class="footer"><form-button @click="${this.okHandle}" ?hidden="${!e}">${e}</form-button><form-button @click="${this.cancelHandle}" ?hidden="${!i}" type="secondary">${i}</form-button></div></div>`}mounted(){this.hidden=!1}updated(){const{isOpen:t}=Dt.confirmState;t?this.classList.add("open"):this.classList.remove("open")}}function fe(t,e,i){const a=[t,e,i].map(t=>(t/=255)<=.03928?t/12.92:(t+.055)/1.055**2.4);return.2126*a[0]+.7152*a[1]+.0722*a[2]}function ge(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}ue(me,"observedStores",[Dt.confirmState]),customElements.define("app-confirm",me);function be(t){const e=[[0,1],[.2,.7],[.3,.6]],i=function(t,e,i){let a,o,n;if(0===e)a=i,o=i,n=i;else{const r=i<.5?i*(1+e):i+e-i*e,s=2*i-r;a=ge(s,r,t+1/3),o=ge(s,r,t),n=ge(s,r,t-1/3)}return[Math.round(255*a),Math.round(255*o),Math.round(255*n)]}(...function(t){const e=()=>Math.floor(256*Math.random()),i=[e(),e(),e()];return"hex"===t?`#${i.reduce((t,e)=>t+e.toString(16),"")}`:i}().map((t,i)=>{const a=t/255;return e[i][0]+a*(e[i][1]-e[i][0])})),a=`rgb(${i.join(",")})`,o=fe(...i)<.2?"#ffffff44":"#00000044",n=()=>Math.random()/5,r=[...String(t)].map(t=>`<text\n      x="50%"\n      y="50%"\n      dominant-baseline="middle"\n      text-anchor="middle"\n      transform="translate(${n()}, ${n()}) rotate(${(()=>45*(Math.random()-.5))()})"\n    >${t}</text>`);return`data:image/svg+xml,${encodeURIComponent(`<svg width="300" height="300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1">\n      <style>\n        :root {\n          background: ${a};\n          fill: ${o};\n          font: 1px sans-serif;\n        }\n      </style>\n      ${r.join("")}\n    </svg>`)}`}async function ye(t,{width:e=512,height:i=512}={}){const a=new Image,o=function(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}(e,i),n=o.getContext("2d");return a.src=t,await new Promise(t=>{a.onload=()=>{n.drawImage(a,0,0,e,i),t()}}),o.toDataURL()}const ve=async({img:t=new Image,file:e},i,a)=>{const o=document.createElement("canvas");try{t.naturalWidth||(t.src=await(t=>{const e=new FileReader;return new Promise(i=>{e.addEventListener("load",()=>{i(e.result)},!1),e.readAsDataURL(t)})})(e),await new Promise((e,i)=>{t.onload=e,t.onerror=i}));const n=Math.min(i.filesize?Math.sqrt(i.filesize/e.size):1,i.size?i.size.width/t.naturalWidth:1,i.size?i.size.height/t.naturalHeight:1);if(n>=1)return Promise.resolve(e);o.width=t.naturalWidth*n,o.height=t.naturalHeight*n;const r=o.getContext("2d");return r.imageSmoothingQuality="high",r.drawImage(t,0,0,o.width,o.height),a&&"dataUrl"===a.output?Promise.resolve(o.toDataURL()):new Promise(t=>o.toBlob(i=>{t(new File([i],e.name,{type:i.type}))},e.type))}catch(t){throw new Error("compressionImg error")}};function we(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const xe=new Map;class Se extends dt{constructor(...t){super(...t),we(this,"state",{altPlaceholder:null})}static async getAltPlaceholder(t=""){return xe.has(t)||xe.set(t,new Promise(async e=>{e(be(await at(t)))})),xe.get(t)}get img(){return this.shadowRoot.querySelector("img")}render(){const{aspectRatio:t=1,fit:e="cover",src:i}=this.dataset,{altPlaceholder:a}=this.state,o=pe({autosize:"auto"===t});return j`<style>:host{display:block;position:relative;overflow:hidden;contain:content;font-size:0}.img{position:absolute;width:100%;height:100%;top:0;left:0;object-fit:${e};color:transparent}.img.autosize{position:static}.img::before{content:'';display:inline-block;width:100%;height:100%;background:var(--player-text-secondary-color) center no-repeat;background-size:contain}.img:not([src])::before{visibility:hidden}.dimension{width:100%;padding-bottom:${100*t}%}.dimension.autosize{display:none}</style><img crossorigin="anonymous" alt=" " class="img ${o}" src="${ot(i||a)}"><div class="dimension ${o}"></div>`}async mounted(){const{alt:t,src:e}=this.dataset;e||this.setState({altPlaceholder:await Se.getAltPlaceholder(t)})}async attributeChanged(t){const{src:e,alt:i}=this.dataset;"data-alt"!==t&&"data-src"!==t||this.setState({altPlaceholder:e?null:await Se.getAltPlaceholder(i)})}}var ke,$e,Ee,Pe,He,Ae,Oe,Te;function Ne(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Le(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}we(Se,"observedAttributes",["data-alt","data-src","data-aspect-ratio","data-lazy","data-fit"]),customElements.define("app-img",Se),customElements.define("form-button",($e=ke=class extends dt{render(){const t=this.getAttribute("disabled"),e=this.getAttribute("type")||"";return j`<style>:focus{outline:0}button{position:relative;overflow:hidden;padding:1rem;border:none;border-radius:2px;background:0 0;text-transform:uppercase;color:var(--theme-color);font-size:1.4rem;font-weight:500}button.secondary{color:var(--form-text-secondary-color)}button:disabled{cursor:not-allowed;color:var(--form-text-disabled-color)}@media ${B.HOVER}{button:hover:not(:disabled){background:var(--form-hover-background-color)}}</style><button class="${e}" ?disabled="${t}"><slot></slot><app-ripple type="touch" ?disabled="${t}"></app-ripple></button>`}},function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(ke,"observedAttributes",["disabled","type"]),$e)),customElements.define("form-img",(Pe=Ee=class extends dt{constructor(){super(),Ne(this,"clickHandle",()=>{this.shadowRoot.querySelector("input").click()}),Ne(this,"changeHandle",()=>{const t=this.shadowRoot.querySelector("input"),e=t.files[0];this.limit?ve({file:e},this.limit).then(t=>{this.revokeURL(),this.setState({file:t,blobUrl:URL.createObjectURL(t)})}):(this.revokeURL(),this.setState({file:e,blobUrl:URL.createObjectURL(e)})),t.value=""}),Ne(this,"revokeURL",()=>{const{blobUrl:t}=this.state;t&&URL.revokeObjectURL(t)}),this.onclick=this.clickHandle,this.state={file:null,blobUrl:""}}get value(){return this.state.file}render(){const{blobUrl:t}=this.state,e=this.getAttribute("name"),i=this.getAttribute("src");return j`<style>:host{position:relative;display:block}:host(:hover) .hint{display:flex;justify-content:center;align-items:center}img{width:100%;height:100%;object-fit:cover;overflow:hidden;position:absolute}img::before{content:'';display:inline-block;width:100%;height:100%;background:var(--player-text-secondary-color) center no-repeat;background-size:contain}.hint{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:#0008;color:#fff;font-size:1.2rem;text-align:center}@media ${B.HOVER}{:host(:not(:hover)) .hint{display:none}}</style><input type="file" accept="image/*" @change="${this.changeHandle}" name="${e}" hidden> <img alt=" " src="${ot(t||i)}"><div class="hint">change picture</div>`}unmounted(){this.revokeURL()}},Ne(Ee,"observedAttributes",["name"]),Pe)),customElements.define("form-text",(Ae=He=class extends dt{constructor(){super(),this.isComposition=!1,this.inputHandle=this.inputHandle.bind(this),this.compositionHandle=this.compositionHandle.bind(this),this.state={isStartedInput:!1}}get input(){return this.shadowRoot.querySelector("input")}get value(){return this.input.value}set value(t){this.input.value=t}get validity(){return this.setStartedInput(),this.input.validity}setStartedInput(){const{isStartedInput:t}=this.state;t||this.setState({isStartedInput:!0})}inputHandle(){this.setStartedInput(),this.isComposition||this.dispatchEvent(new CustomEvent("change",{detail:this.value}))}compositionHandle({type:t}){this.isComposition="compositionend"!==t}render(){const t=this.getAttribute("name"),e=this.getAttribute("label"),i=this.getAttribute("pattern")||".*",a=this.getAttribute("value")||"",o=this.getAttribute("placeholder")||"",n=this.hasAttribute("required"),r=this.hasAttribute("disabled"),{isStartedInput:s}=this.state;return j`<style>:host(:not([hidden])){display:block;flex-grow:1}:focus{outline:0}.wrap{position:relative;display:block;font-size:1.6rem}.wrap .label{font-size:.75em;color:var(--form-text-secondary-color);text-transform:capitalize}input{display:block;box-sizing:border-box;width:100%;padding:.5em 0;border-width:0 0 1px;border-color:var(--form-text-secondary-color);border-style:solid;background:0 0;color:inherit;caret-color:var(--theme-color);font-size:inherit;border-radius:0}input+.border{pointer-events:none;position:absolute;bottom:0;left:0;width:100%;height:2px;background:0 0;transform:scaleX(0);transition:transform .3s}input:focus,input:hover{border-color:var(--theme-color)}input:focus+.border{background:var(--theme-color);transform:scaleX(1)}input.started-input:invalid{border-color:var(--theme-error-color)}input.started-input:invalid+.border{background:var(--theme-error-color)}</style><label class="wrap"><div class="label" ?hidden="${!e}">${e}</div><input class="${pe({startedInput:s})}" type="text" name="${t}" value="${a}" pattern="${i}" placeholder="${o}" ?required="${n}" ?disabled="${r}" autocomplete="off" @input="${function(t,e=500){let i=0;return(...a)=>{clearTimeout(i),i=setTimeout(t.bind(null,...a),e)}}(this.inputHandle,1e3)}" @compositionstart="${this.compositionHandle}" @compositionupdate="${this.compositionHandle}" @compositionend="${this.compositionHandle}" spellcheck="false"><div class="border"></div></label>`}connected(){this.hasAttribute("autofocus")&&this.focus()}focus(){this.input.focus()}},function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(He,"observedAttributes",["name","label","value","placeholder","disabled","autofocus"]),Ae)),customElements.define("app-form",class extends dt{get elements(){return this.querySelectorAll("[name]")}get value(){const t=new FormData;return this.elements.forEach(e=>{"value"in e&&t.append(e.getAttribute("name"),e.value)}),t}render(){return j`<style>:host{display:block;color:var(--form-text-primary-color)}</style><slot></slot>`}valid(){let t=!0;return this.elements.forEach(e=>{e.validity&&!e.validity.valid&&(t=!1)}),t}}),customElements.define("app-link",(Te=Oe=class extends dt{constructor(){super(),Le(this,"clickHandle",()=>{const{$close:t}=wt.location.state,e=this.getAttribute("path"),i=this.getAttribute("query")||"";this.active||(t?(wt.back(),setTimeout(()=>{wt.push({path:e,query:i})},200)):wt.push({path:e,query:i}))}),this.onclick=this.clickHandle}get active(){const t=this.getAttribute("path"),e=this.getAttribute("query")||"",{href:i}=wt.location;return t+e===i}render(){return this.active?this.setAttribute("active",""):this.removeAttribute("active"),j`<style>:host{display:contents}</style><slot></slot>`}},Le(Oe,"observedStores",[wt.historyState]),Te));const Ie=(t,e)=>{const i=t.startNode.parentNode,a=void 0===e?t.endNode:e.startNode,o=i.insertBefore(v(),a);i.insertBefore(v(),a);const n=new P(t.options);return n.insertAfterNode(o),n},Me=(t,e)=>(t.setValue(e),t.commit(),t),ze=(t,e,i)=>{const a=t.startNode.parentNode,o=i?i.startNode:t.endNode,n=e.endNode.nextSibling;n!==o&&c(a,e.startNode,n,o)},Ce=t=>{d(t.startNode.parentNode,t.startNode,t.endNode.nextSibling)},De=(t,e,i)=>{const a=new Map;for(let o=e;o<=i;o++)a.set(t[o],o);return a},je=new WeakMap,Re=new WeakMap,_e=(t=>(...e)=>{const i=t(...e);return r.set(i,!0),i})((t,e,i)=>{let a;return void 0===i?i=e:void 0!==e&&(a=e),e=>{if(!(e instanceof P))throw new Error("repeat can only be used in text bindings");const o=je.get(e)||[],n=Re.get(e)||[],r=[],s=[],l=[];let c,d,p=0;for(const e of t)l[p]=a?a(e,p):p,s[p]=i(e,p),p++;let u=0,h=o.length-1,m=0,f=s.length-1;for(;u<=h&&m<=f;)if(null===o[u])u++;else if(null===o[h])h--;else if(n[u]===l[m])r[m]=Me(o[u],s[m]),u++,m++;else if(n[h]===l[f])r[f]=Me(o[h],s[f]),h--,f--;else if(n[u]===l[f])r[f]=Me(o[u],s[f]),ze(e,o[u],r[f+1]),u++,f--;else if(n[h]===l[m])r[m]=Me(o[h],s[m]),ze(e,o[h],o[u]),h--,m++;else if(void 0===c&&(c=De(l,m,f),d=De(n,u,h)),c.has(n[u]))if(c.has(n[h])){const t=d.get(l[m]),i=void 0!==t?o[t]:null;if(null===i){const t=Ie(e,o[u]);Me(t,s[m]),r[m]=t}else r[m]=Me(i,s[m]),ze(e,i,o[u]),o[t]=null;m++}else Ce(o[h]),h--;else Ce(o[u]),u++;for(;m<=f;){const t=Ie(e,r[f+1]);Me(t,s[m]),r[m++]=t}for(;u<=h;){const t=o[u++];null!==t&&Ce(t)}je.set(e,r),Re.set(e,l)}});function Ue(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Ve extends dt{constructor(...t){super(...t),Ue(this,"renderItem",t=>{const{errorList:e,currentSong:i,state:a}=Dt.playerState,o="paused"===a?"pause":"playing",n=e.includes(t),{updatedAt:r}=_t.get(t);return j`<song-list-item id="${t}" updatedat="${r}" ?error="${n}" ?active="${i===t}"><app-icon name="${o}" ?hidden="${i!==t||n}"></app-icon></song-list-item>`})}render(){const t=this.getAttribute("id"),e=this.getAttribute("filtername"),i=this.getAttribute("filtervalue");let a;return({list:a=[]}=null!==t?Ut.get(t):this.data),e&&(a=a.filter(t=>_t.get(t)[e]===i)),j`<style>:host{flex-grow:1}</style>${_e(a,t=>t,this.renderItem)}`}mounted(){this.connectStores([this.data]),this.fetchData&&this.fetchData()}attributeChanged(){this.fetchData&&this.fetchData()}}Ue(Ve,"observedAttributes",["id","filtername","filtervalue"]),Ue(Ve,"observedPropertys",["data"]),Ue(Ve,"observedStores",[Dt.playerState]),customElements.define("app-song-list",Ve);const qe=t=>{const e=Math.round(t%60);return`${Math.floor(t/60)}:${e>9?e:`0${e}`}`};function We(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const Be=Object.assign({},Dt.menuState);class Fe extends pt{constructor(...t){super(...t),We(this,"closeHandle",()=>{const{onclose:t}=Dt.menuState;Fe.close(),B.isPhone&&wt.back(),t&&t()}),We(this,"clickHandle",t=>{const{list:e}=Dt.menuState;this.closeHandle(),setTimeout(e[t].handle,100)})}static open(t){Q(Dt.menuState,{...Be,...t,isOpen:!0}),B.isPhone&&wt.pushState({title:t.title,close:Fe.close})}static close(){Q(Dt.menuState,{isOpen:!1}),setTimeout(()=>{const{isOpen:t}=Dt.menuState;t||Q(Dt.menuState,{type:""})},200)}render(){const{list:t,target:e,stage:i,type:a}=Dt.menuState,o={x:0,y:0},n={x:0,y:0};if(i&&e){const a=i.getBoundingClientRect(),r=e.getBoundingClientRect();o.x=r.x,o.y=r.y+r.height,a.right-r.right<169&&(n.x=-100,o.x=r.x+r.width,B.isPhone&&(o.y-=r.height)),a.bottom-r.bottom<34*t.length+16&&(n.y=-100,o.y=r.y,B.isPhone&&(o.y+=r.height))}const r=t.map((t,e)=>j`<li @click="${()=>this.clickHandle(e)}">${t.text}<app-ripple type="touch" scale="1"></app-ripple></li>`),s="center"===a?"":`\n      left: ${o.x}px;\n      top: ${o.y}px;\n      transform: translate(${n.x}%, ${n.y}%);\n    `;return j`<style>:host{z-index:10;position:fixed;left:0;top:0;display:block;width:100%;height:100%;opacity:0;pointer-events:none}:host(.open){opacity:1;pointer-events:auto}.backdrop{position:absolute;top:0;left:0;width:100%;height:100%}.backdrop.center{background:var(--theme-backdrop-color)}.menu{position:absolute;overflow:auto;scrollbar-width:none;border-radius:.2rem;box-shadow:var(--menu-box-shadow)}.menu::-webkit-scrollbar{width:0}.menu.center{top:50%;left:50%;transform:translate(-50%,-50%);width:30rem;max-width:calc(var(--safe-width) * .9);max-height:calc(var(--safe-height) * .9)}.menu.center ol{transition:none;width:100%;margin:0}ol{width:16.9rem;margin:0 0 -2rem -3rem;padding:.8rem 0;background:var(--menu-background-color);color:var(--menu-text-color)}:host(.open) ol{margin:0}li{position:relative;line-height:4.4rem;padding:0 1.4rem;list-style:none;text-transform:capitalize;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}@media ${B.HOVER}{li:hover{cursor:default;background:var(--menu-hover-background-color);color:var(--menu-hover-text-color)}}@media ${B.PHONE}{ol{padding:0}:host,ol{transition-property:margin,opacity;transition-duration:.1s;transition-timing-function:cubic-bezier(.4,0,.2,1)}}</style><div @click="${this.closeHandle}" class="backdrop ${a}"></div><div class="menu ${a}" style="${s}"><ol>${r}</ol></div>`}mounted(){this.hidden=!1}updated(){const{isOpen:t}=Dt.menuState;t?this.classList.add("open"):this.classList.remove("open")}}function Ye(t){const e=document.createElement("app-form");D(j`<style>app-form{display:flex}form-img{width:10rem;height:10rem;margin:0 var(--modal-margin) var(--modal-margin) 0}form-text{margin-bottom:2em}.text{flex-grow:1}@media ${B.PHONE}{app-form{flex-direction:column}}</style><form-img name="picture" .limit="${{size:{width:512,height:512},filesize:204800}}" src="${ot(t.picture)}"></form-img><div class="text"><form-text label="title" name="title" value="${t.title||""}"></form-text><form-text label="artist" name="artist" value="${t.artist||""}"></form-text><form-text label="album" name="album" value="${t.album||""}"></form-text></div>`,e);return{title:"edit music info",complete:"save",cancel:"cancel",template:e,oncomplete:()=>{Bt(Number(t.id),e.value)}}}var Ke,Xe,Ge,Je,Qe,Ze;function ti(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}We(Fe,"observedStores",[Dt.menuState]),customElements.define("app-menu",Fe),customElements.define("song-list-item",(Xe=Ke=class extends ut{constructor(){super(),ti(this,"clickHandle",()=>{Q(Dt.playerState,{currentSong:Number(this.id),state:"playing"})}),ti(this,"addToPlaylist",async()=>{const t=Number(this.id),{list:e}=Dt.playlistData;Fe.open({type:"center",list:e.map(e=>({text:Ut.get(e).title,handle(){Gt(e,t)}}))})}),ti(this,"openMenuHandle",t=>{this.classList.add("hover");const{path:e,query:i}=wt.location,a=[{text:"edit",handle:this.editHandle},{text:"delete",handle:this.deleteHandle}],o=e===oe.PLAYLIST.path&&i.get("id");o?a.push({text:"remove from playlist",handle:()=>(async(t,e)=>{const{list:i=[]}=Ut.get(t);await jt(`/playlist/${t}/songs/${e}`,{method:"delete"});const a=i.findIndex(t=>e===t);i.splice(a,1),Q(Dt.playlistData,{})})(o,Number(this.id))}):a.push({text:"add to playlist",handle:this.addToPlaylist}),e===oe.FAVORITES.path&&a.push({text:"remove from favorites",handle:()=>Bt(Number(this.id),{star:0})}),Fe.open({list:a,target:t.currentTarget,stage:B.isPhone?document.body:this.getRootNode().host,onclose:()=>this.classList.remove("hover")}),t.stopPropagation()}),ti(this,"editHandle",()=>{ie.open(Ye(_t.get(Number(this.id))))}),ti(this,"deleteHandle",()=>{me.open({complete:"confirm",cancel:"cancel",text:"delete song?",oncomplete:()=>(async t=>{const{list:e}=Dt.songData;await jt(`/songs/${t}`,{method:"delete"});const i=e.findIndex(e=>e===t);e.splice(i,1),Q(Dt.songData,{list:e})})(Number(this.id))})}),this.onclick=this.clickHandle}render(){const t=_t.get(Number(this.id));return j`<style>:host{contain:content;position:relative;display:flex;padding:1.6rem;transition:background-color .3s}:host([active]){--list-item-playing-color:var(--theme-color)}:host([error]){--list-item-playing-color:var(--theme-error-color)}.info{flex-grow:1;width:0}.title{color:var(--list-item-playing-color);fill:var(--list-item-playing-color)}::slotted(app-icon:not([hidden])){vertical-align:middle;margin:-.6rem 0 -.4rem -.5rem}.name,.title{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.name{margin-top:.25em}.name:blank{display:none}.duration,.name{font-size:.875em;color:var(--list-text-secondary-color)}.more app-icon{margin-top:-.2rem}.more app-ripple{z-index:1}.duration,.more{min-width:4rem;padding-left:.75rem;text-align:right}.duration{padding-top:.125em;color:var(--list-item-playing-color)}@media ${B.HOVER}{:host(.hover),:host(:hover){background:var(--list-hover-background-color)}.more{display:none}:host(.hover) .more,:host(:hover) .more{display:block}}@media ${B.PHONE}{.more app-ripple{transform:scale(2)}}</style><div class="info"><div class="title"><slot></slot>${t.title}</div><div class="name">${t.artist||"unknown"}</div></div><div class="more"><app-icon @click="${this.openMenuHandle}" name="more-horiz"><app-ripple circle></app-ripple></app-icon></div><div class="duration">${qe(t.duration)}</div><app-ripple type="touch"></app-ripple>`}},ti(Ke,"observedAttributes",["id","updatedat"]),Xe));class ei extends Ve{constructor(...t){super(...t),function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(this,"renderItem",t=>{const{id:e,title:i,image:a,updatedAt:o}=Ut.get(t),n={path:oe.PLAYLIST.path,query:`?id=${e}`};return j`<gallery-item title="${i}" .link="${n}" .data="${{id:e,image:a,title:i}}" updatedat="${o}"></gallery-item>`})}render(){const{list:t}=this.data;return j`<style>:host{flex-grow:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(13rem,1fr));grid-template-rows:max-content;grid-gap:2rem}@media ${B.PHONE}{:host{padding:.4rem;grid-template-columns:repeat(auto-fill,minmax(10rem,1fr));grid-gap:1rem}}</style>${_e(t,t=>t,this.renderItem)}`}}function ii(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ai(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}customElements.define("app-playlist-list",ei),customElements.define("app-album-list",class extends ei{constructor(...t){super(...t),function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(this,"renderItem",({title:t,cover:e})=>{const i={path:oe.SONGS.path,query:`?${oe.ALBUMS.subTitle}=${encodeURIComponent(t)}`};return j`<gallery-item title="${t}" .link="${i}" .data="${{image:e,title:t}}"></gallery-item>`})}}),customElements.define("app-artist-list",class extends ei{constructor(...t){super(...t),function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(this,"renderItem",({name:t,photo:e})=>{const i={path:oe.SONGS.path,query:`?${oe.ARTISTS.subTitle}=${encodeURIComponent(t)}`};return j`<gallery-item title="${t}" .link="${i}" .data="${{image:e,title:t}}"></gallery-item>`})}}),customElements.define("gallery-item",(Je=Ge=class extends ut{constructor(...t){super(...t),ii(this,"onClick",()=>{this.link&&wt.push(this.link)})}render(){const{image:t,title:e,dec:i=""}=this.data;return j`<style>:host{position:relative;text-align:center}.footer{padding:1rem}.name,.title{line-height:1.3em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media ${B.HOVER}{:host(:hover){cursor:pointer}}@media ${B.PHONE}{.footer{padding:.4rem}}</style><app-img data-src="${t||""}" data-alt="${e}"></app-img><div class="footer"><div class="title">${e}</div><div class="dec">${i}</div></div><app-ripple @click="${this.onClick}" type="touch"></app-ripple>`}},ii(Ge,"observedAttributes",["id","updatedat"]),Je)),customElements.define("app-notfound",class extends dt{render(){return j`<style>:host{flex-grow:1;display:flex;flex-direction:column;justify-content:center;align-items:center;color:var(--notfound-text-secondary-color);fill:var(--notfound-text-secondary-color)}h1{margin:.2em 0;font-size:3em;font-weight:500;text-transform:uppercase}app-link{color:var(--notfound-text-primary-color)}app-link span{border-bottom:1px solid transparent}@media ${B.HOVER}{app-link span:hover{cursor:pointer;border-color:currentColor}}</style><h1>not found</h1><app-link path="${oe.HOME.path}" title="go homepage"><span>${ce("go homepage")}</span></app-link>`}}),customElements.define("player-song-info",(Ze=Qe=class extends dt{constructor(...t){super(...t),ai(this,"addToPlaylist",()=>{const{currentSong:t}=Dt.playerState,{list:e}=Dt.playlistData;Fe.open({type:"center",list:e.map(e=>({text:Ut.get(e).title,handle(){Gt(e,t)}}))})}),ai(this,"tooglePipMode",()=>{const{pip:t}=Dt.playerState;Q(Dt.playerState,{pip:t?null:this.shadowRoot.querySelector("app-img").img})})}render(){const{currentSong:t,pip:e}=Dt.playerState,i=_t.get(t);return j`<style>:host{display:flex;align-items:center;font-size:1.4rem}.img{--padding:1.6rem;position:relative;flex-shrink:0;margin:var(--padding);width:calc(var(--player-height) - (var(--padding)) * 2);box-shadow:var(--player-cover-box-shadow)}app-img{width:100%;height:100%}.pip{display:none}.wrap{display:contents}.text{overflow:hidden}.artist,.name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.artist{margin-top:.28em;font-size:.85em;color:var(--player-text-secondary-color)}.wrap app-icon{padding:1.6rem}.add-playlist{display:none}@media ${B.DESKTOP}{.img:hover .pip:not([hidden]){display:flex;position:absolute;top:0;left:0;width:100%;height:100%;justify-content:center;align-items:center;background:rgba(0,0,0,.45);cursor:pointer}}@media ${B.PHONE}{:host(:not([maximize])) .img,:host(:not([maximize])) .star{display:none}:host([maximize]){flex-direction:column;font-size:1.6rem}:host([maximize]) .img{display:flex;flex-shrink:1;width:calc(100vw - 5.6rem);margin:0}:host([maximize]) .text{flex-grow:1;box-sizing:border-box;padding:1.6rem 0;text-align:center}:host([maximize]) .wrap{display:flex;width:100%}:host([maximize]) .star{order:-1}:host([maximize]) .add-playlist{display:block}:host([maximize]) .name{width:auto}:host([maximize]) .artist{width:auto}}@media ${B.SMALL_PHONE}{:host([maximize]) .img{height:0;flex-grow:1}:host([maximize]) .wrap{flex-grow:0}}@media ${B.WATCH}{.img,.wrap app-icon{display:none}.wrap{width:100%}}@media ${B.SHORT}{.img{width:20vw;height:100%;margin-left:0}}</style><div class="img"><app-img data-src="${i.picture||""}" data-alt="${i.title}"></app-img><div class="pip" ?hidden="${!document.pictureInPictureEnabled}" @click="${this.tooglePipMode}"><app-icon name="${e?"pip-open":"pip"}"></app-icon></div></div><div class="wrap"><div class="text"><div class="name">${i.title}</div><div class="artist">${i.title?i.artist||"unknown":""}</div></div><app-icon class="add-playlist" @click="${this.addToPlaylist}" name="add-circle-outline"><app-ripple circle></app-ripple></app-icon><app-icon class="star" @click="${()=>Bt(i.id,{star:i.star?0:1})}" name="${i.star?"star":"star-border"}"><app-ripple circle></app-ripple></app-icon></div>`}},ai(Qe,"observedStores",[Dt.playerState]),Ze));const oi=()=>{},ni={async setMetadata({title:t,artist:e,album:i,picture:a}){if("mediaSession"in navigator){const o={title:t};e&&(o.artist=e),i&&(o.album=i);const n=a||await(async t=>ye(await Se.getAltPlaceholder(t)))(t);o.artwork=[{src:ot(n)}],navigator.mediaSession.metadata=new window.MediaMetadata(o),navigator.mediaSession.setActionHandler("play",ni.onplay),navigator.mediaSession.setActionHandler("pause",ni.onpause),navigator.mediaSession.setActionHandler("previoustrack",ni.onprevioustrack),navigator.mediaSession.setActionHandler("nexttrack",ni.onnexttrack)}},onplay:oi,onpause:oi,onseekbackward:oi,onseekforward:oi,onprevioustrack:oi,onnexttrack:oi};var ri,si,li,ci,di,pi,ui,hi,mi,fi,gi,bi,yi=ni;function vi(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function wi(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function xi(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Si(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ki(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function $i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}customElements.define("player-control",(si=ri=class extends dt{constructor(){super(),vi(this,"clickShuffleHandle",()=>{const{shuffle:t}=Dt.playerState;Q(Dt.playerState,{shuffle:!t})}),vi(this,"clickPrevHandle",()=>{const{currentSong:t}=Dt.playerState,{list:e}=Dt.songData,i=e.findIndex(e=>e===t);let a;a=0===i?e.length-1:i-1,Q(Dt.playerState,{currentSong:e[a]})}),vi(this,"clickPlayHandle",()=>{const{state:t,currentSong:e}=Dt.playerState;Q(Dt.playerState,{currentSong:null===e?0:e,state:"paused"===t?"playing":"paused"})}),vi(this,"clickNextHandle",()=>{const{currentSong:t}=Dt.playerState,{list:e}=Dt.songData,i=e.findIndex(e=>e===t);let a;a=i===e.length-1?0:i+1,Q(Dt.playerState,{currentSong:e[a],state:"playing"})}),vi(this,"clickModeHandle",()=>{const{mode:t}=Dt.playerState;Q(Dt.playerState,{mode:"repeat"===t?"repeat-one":"repeat"})}),yi.onplay=this.clickPlayHandle,yi.onpause=this.clickPlayHandle,yi.onprevioustrack=this.clickPrevHandle,yi.onnexttrack=this.clickNextHandle}render(){const{state:t,shuffle:e,mode:i}=Dt.playerState;return j`<style>:host{display:flex;align-items:center;justify-content:space-between;width:24.6rem;padding:0 1.6rem}app-icon.play{padding:1.3rem;border:2px solid;border-radius:100%}app-icon.edge{color:var(--player-text-secondary-color);fill:var(--player-text-secondary-color)}[error]{color:var(--theme-error-color);fill:var(--theme-error-color)}@media ${B.PHONE}{:host(:not([maximize])){width:auto;padding:0}:host(:not([maximize])) app-icon:not(.play){display:none}:host(:not([maximize])) app-icon.play{padding:1.6rem;border:none}:host([maximize]){margin:2.4rem auto}:host([maximize]) app-icon.play{padding:2rem}}@media ${B.WATCH}{:host{justify-content:space-evenly}app-icon.edge{display:none}}</style><app-icon @click="${this.clickShuffleHandle}" class="edge" name="shuffle" style="opacity:${e?1:.5}"><app-ripple circle></app-ripple></app-icon><app-icon @click="${this.clickPrevHandle}" name="skip-previous"><app-ripple circle></app-ripple></app-icon><app-icon @click="${this.clickPlayHandle}" class="play" ?error="${"error"===t}" name="${"paused"===t?"play-arrow":"pause"}"><app-ripple circle></app-ripple></app-icon><app-icon @click="${this.clickNextHandle}" name="skip-next"><app-ripple circle></app-ripple></app-icon><app-icon @click="${this.clickModeHandle}" class="edge" name="${i}"><app-ripple circle></app-ripple></app-icon>`}},vi(ri,"observedStores",[Dt.playerState]),si)),customElements.define("player-volume",(ci=li=class extends dt{constructor(...t){super(...t),wi(this,"changeHandle",({detail:t})=>{Q(Dt.playerState,{volume:t/100})}),wi(this,"clickHandle",()=>{const{muted:t}=Dt.playerState;Q(Dt.playerState,{muted:!t})})}render(){const{volume:t,muted:e}=Dt.playerState;let i;return j`<style>:host{display:flex;justify-content:flex-end;align-items:center}app-icon{margin-right:1.6rem}app-range{max-width:14.4rem;margin-right:2.4rem;flex-shrink:1;flex-grow:1}</style><app-icon name="${i=0===t||e?"volume-off":t<.3?"volume-mute":t<.66?"volume-down":"volume-up"}" @click="${this.clickHandle}"><app-ripple circle></app-ripple></app-icon><app-range @change="${this.changeHandle}" value="${100*t}"></app-range>`}},wi(li,"observedStores",[Dt.playerState]),ci)),customElements.define("player-progress",(pi=di=class extends dt{constructor(){super(),xi(this,"clickHandle",({x:t})=>{const{duration:e}=Dt.audioState,{left:i,width:a}=this.getBoundingClientRect(),o=Math.floor((t-i)*e/a);Q(Dt.audioState,{currentTime:o})}),this.onclick=this.clickHandle}render(){const{currentTime:t,duration:e}=Dt.audioState;return j`<style>:host{position:absolute;left:0;top:0;width:100%;height:3px;margin-top:-3px;padding-top:3px;padding-bottom:3px}.track{height:100%}.value{height:100%;background:var(--theme-color)}.times{display:none}@media ${B.HOVER}{:host{cursor:pointer}}@media ${B.PHONE}{:host([maximize]){position:static;width:calc(100vw - 3.2rem);margin:1.125em auto}:host([maximize]) .track{background:var(--player-text-secondary-color)}:host([maximize]) .times{display:flex;justify-content:space-between;margin-top:.5em;font-size:.75em}}@media ${B.SHORT}{:host{margin-left:20vw}}</style><div class="track"><div class="value" style="width:${100*(t/e).toFixed(4)}%"></div></div><div class="times"><span>${qe(t)}</span> <span>${qe(e)}</span></div>`}},xi(di,"observedStores",[Dt.audioState]),pi)),customElements.define("player-audio",(hi=ui=class extends dt{constructor(){if(super(),Si(this,"endHandle",()=>{const{shuffle:t,mode:e}=Dt.playerState;t?this.randomPlay():"repeat"===e?this.nextPlay():this.audio.play()}),Si(this,"randomPlay",()=>{const{list:t}=Dt.songData,e=Math.floor(Math.random()*t.length);Q(Dt.playerState,{currentSong:t[e]})}),Si(this,"nextPlay",()=>{const{currentSong:t}=Dt.playerState,{list:e}=Dt.songData,i=e.findIndex(e=>e===t);let a;a=i===e.length-1?0:i+1,Q(Dt.playerState,{state:"playing",currentSong:e[a]})}),Si(this,"playSuccess",()=>{const{currentSong:t,errorList:e,state:i}=Dt.playerState,a=e.indexOf(t),o=a>-1,n="playing"===i;o&&e.splice(a,1),!o&&n||Q(Dt.playerState,{errorList:e,state:"playing"})}),Si(this,"playError",()=>{const{currentSong:t,errorList:e,state:i}=Dt.playerState,a=e.includes(t),o="error"===i;a||e.push(t),a&&o||Q(Dt.playerState,{errorList:e,state:"error"})}),Si(this,"enterPictureInPicture",()=>{this.video.requestPictureInPicture().catch(t=>{console.error(t),Q(Dt.playerState,{pip:null})})}),Si(this,"render",()=>{const{currentSong:t,state:e,volume:i,muted:a,pip:o}=Dt.playerState,{currentTime:n}=Dt.audioState,r=_t.get(t);"id"in r&&(document.pictureInPictureElement&&!o&&document.exitPictureInPicture(),!document.pictureInPictureElement&&o&&this.enterPictureInPicture(),a!==this.audio.muted&&(this.audio.muted=a),B.isPhone||i===this.audio.volume||(this.audio.volume=i),Math.abs(n-this.audio.currentTime)>1.2&&(this.audio.currentTime=n),r.id!==Number(this.id)&&(this.id=r.id,this.audio.src=ot(r.src),Q(Dt.audioState,{currentTime:0}),yi.setMetadata(r)),"playing"===e&&this.audio.paused&&(this.audio.play(),this.video.play()),"paused"!==e||this.audio.paused||(this.audio.pause(),this.video.pause()))}),Si(this,"setCurrentTime",()=>{setInterval(()=>{const{duration:t}=Dt.audioState;this.audio.paused||this.audio.error||Q(Dt.audioState,{currentTime:this.audio.duration?this.audio.currentTime:0,duration:this.audio.duration||t})},1e3)}),this.audio=new Audio,this.audio.onended=this.endHandle.bind(this),this.audio.onerror=this.playError.bind(this),this.audio.onplaying=this.playSuccess.bind(this),this.audio.onabort=this.playSuccess.bind(this),this.audio.onplay=()=>this.video&&this.video.play(),this.audio.onpause=()=>this.video&&this.video.pause(),this.setCurrentTime(),this.video=document.createElement("video"),B.isDesktop){const t=document.createElement("canvas");t.width=300,t.height=300;const e=t.getContext("2d");this.video.hidden=!0,this.video.muted=!0,this.video.playsInline=!0,this.video.srcObject=t.captureStream(),this.video.play();const i=()=>{const{pip:t}=Dt.playerState;if(t){const i=t.naturalWidth>t.naturalHeight;e.drawImage(t,i?(t.naturalWidth-t.naturalHeight)/2:0,i?0:-(t.naturalWidth-t.naturalHeight)/2,i?t.naturalHeight:t.naturalWidth,i?t.naturalHeight:t.naturalWidth,0,0,300,300)}else e.rect(0,0,1,1),e.fill();setTimeout(i,80)};i(),this.video.addEventListener("leavepictureinpicture",()=>{Q(Dt.playerState,{pip:null})})}}async mounted(){const t=await Vt();t[0]&&Q(Dt.playerState,{currentSong:t[0].id})}},Si(ui,"observedStores",[Dt.playerState,Dt.audioState]),hi)),customElements.define("app-player",(fi=mi=class extends dt{constructor(...t){super(...t),ki(this,"close",()=>{this.removeAttribute("maximize"),Q(Dt.playerState,{maximize:!1})}),ki(this,"clickHandle",()=>{const{maximize:t}=Dt.playerState;t?(this.removeAttribute("maximize"),Q(Dt.playerState,{maximize:!1}),wt.back()):(this.setAttribute("maximize",""),Q(Dt.playerState,{maximize:!0}),wt.pushState({close:this.close}))}),ki(this,"editHandle",()=>{const{currentSong:t}=Dt.playerState,e=_t.get(t);ie.open(Ye(e))}),ki(this,"searchHandle",()=>{this.clickHandle(),setTimeout(()=>{wt.push({path:oe.SEARCH.path,close:()=>setTimeout(this.clickHandle,100)})},100)})}render(){const{maximize:t}=Dt.playerState;return j`<style>:host{z-index:5;contain:strict;position:-webkit-sticky;position:sticky;bottom:0;flex-shrink:0;height:var(--player-height);padding-bottom:env(safe-area-inset-bottom);box-sizing:border-box;display:flex;overflow:hidden;background:var(--player-background-color);border-top:1px solid var(--player-separator-color);color:var(--player-text-primary-color);fill:var(--player-text-primary-color)}player-control{flex-shrink:0}player-song-info,player-volume{flex-shrink:1;flex-grow:1;width:0}.header{display:none}@media ${B.PHONE}{:host{position:fixed;width:100%;transition:height .3s}:host([maximize]){flex-direction:column;justify-content:space-between;height:100%;padding-top:env(safe-area-inset-top)}:host([maximize]) player-song-info{width:auto;flex-grow:initial}.header{display:flex;align-items:center;flex-shrink:0;justify-content:space-between;padding:.4rem}:host(:not([maximize])) .header{margin-right:1.6rem}:host([maximize]) .nav{margin-right:auto}:host(:not([maximize])) .action{display:none}.header app-icon{padding:1.2rem}}@media ${B.SMALL_PHONE}{:host([maximize]) player-song-info{flex-grow:1}}@media ${B.MOTION_REDUCE}{:host{transition:none}}@media ${B.WATCH},${B.PHONE},${B.SHORT}{:host{border-top:none}player-volume{display:none}}@media ${B.WATCH}{:host{position:fixed;flex-direction:column;justify-content:space-evenly;align-items:center;width:100%;height:100%}player-song-info{width:90%;flex-grow:initial;text-align:center}}</style><player-audio hidden></player-audio><div class="header"><app-icon class="nav" @click="${this.clickHandle}" name="${t?"expand-more":"expand-less"}"><app-ripple scale=".8" circle></app-ripple></app-icon><app-icon class="action" @click="${this.editHandle}" name="edit"><app-ripple scale=".8" circle></app-ripple></app-icon><app-icon class="action" @click="${this.searchHandle}" name="search"><app-ripple scale=".8" circle></app-ripple></app-icon></div><player-song-info ?maximize="${t}"></player-song-info><player-progress ?maximize="${t}"></player-progress><player-control ?maximize="${t}"></player-control><player-volume></player-volume>`}},ki(mi,"observedStores",[Dt.playerState]),fi)),customElements.define("app-range",(bi=gi=class extends dt{constructor(...t){super(...t),$i(this,"clickHandle",({x:t})=>{const{left:e,width:i}=this.getBoundingClientRect(),a=Math.floor(100*(t-e)/i);this.setAttribute("value",a),this.dispatchEvent(new CustomEvent("change",{detail:a}))})}render(){const t=this.getAttribute("value");return j`<style>:host{display:flex;flex-direction:row-reverse;align-items:center}.track{width:100%;height:2px;padding:calc((1em - 2px)/ 2) 0;background:var(--player-text-secondary-color);background-clip:content-box}.value{position:relative;height:100%;background:currentColor}.dot{position:absolute;top:50%;right:0;width:.75em;height:.75em;border-radius:100%;background:currentColor;transform:translate(50%,-50%)}</style><div class="track" @click="${this.clickHandle}"><div class="value" style="width:${t}%"><div class="dot"></div></div></div>`}},$i(gi,"observedAttributes",["value"]),bi)),customElements.define("app-ripple",class extends dt{constructor(){super();const t=this.getAttribute("type");this.timer=null,"touch"===t?(this.touchHandleTimer=null,this.ontouchstart=this.touchStartHandle,this.ontouchend=this.touchEndHandle):this.onmousedown=this.mouseDownHandle}touchStartHandle({targetTouches:[t]}){const{left:e,top:i}=this.getBoundingClientRect(),a=t.clientX-e,o=t.clientY-i,n=setTimeout(()=>{const{left:t,top:r}=this.getBoundingClientRect();(function t(e,i,a={}){if(!e||!i)return e===i;const o=a.ignores||[],n=[...new Set(Object.keys(e).concat(Object.keys(i)))];for(let r=0;r<n.length;r+=1){const s=n[r];if(!o.includes(s))if(e[s]&&"object"==typeof e[s]){if(!t(e[s],i[s],a))return!1}else if(e[s]!==i[s])return!1}return!0})({left:t,top:r},{left:e,top:i})&&this.touchHandleTimer===n&&this.mouseDownHandle({offsetX:a,offsetY:o})},200);this.touchHandleTimer=n}touchEndHandle(){clearTimeout(this.touchHandleTimer),this.touchHandleTimer=null}mouseDownHandle(t){const{offsetX:e,offsetY:i}=t;if(this.hasAttribute("disabled"))return;const a=this.hasAttribute("circle"),o=parseInt(this.getAttribute("duration"),10)||600,n=this.getAttribute("color")||window.getComputedStyle(this).color,r=this.getAttribute("scale")||(a?1.5:1),s=this.getAttribute("opacity")||.08;this.classList.add("animating");const{clientWidth:l,clientHeight:c}=this,d=performance.now();cancelAnimationFrame(this.timer);const p=t=>{const u=Math.floor(t-d);if(this.style.cssText=`\n          --ripple-x: ${a?l/2:e};\n          --ripple-y: ${a?c/2:i};\n          --ripple-color: ${n};\n          --animation-tick: ${u};\n          --animation-duration: ${o};\n          transform: scale(${r});\n          opacity: ${s};\n        `,u>o)return this.classList.remove("animating"),void(this.style.cssText="--animation-tick: 0");this.timer=requestAnimationFrame(p)};requestAnimationFrame(p)}render(){return j`<style>:host{position:absolute;top:0;left:0;width:100%;height:100%}:host(.animating){background-image:paint(ripple)}:host([circle]){border-radius:100vw}</style>`}});const Ei=async()=>{const t=new Map;_t.forEach(e=>{t.has(e.album)||t.set(e.album,{title:e.album,cover:e.picture})});const e=[...t.values()];return Q(Dt.albumData,{list:e}),e};Z(Dt.songData,Ei);const Pi=new Map,Hi=async()=>{_t.forEach(t=>{Pi.has(t.artist)||Pi.set(t.artist,{name:t.artist,photo:""})});const t=[...Pi.values()];return Q(Dt.artistData,{list:t}),t};var Ai,Oi;function Ti(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Z(Dt.songData,Hi),customElements.define("app-router",(Oi=Ai=class extends dt{constructor(...t){super(...t),Ti(this,"href",wt.location.href)}shouldUpdate(){const{href:t}=wt.location;return t!==this.href&&(this.scrollTop=0,this.href=t,!0)}render(){const{path:t,query:e}=wt.location,i=e.has(oe.ARTISTS.subTitle)?oe.ARTISTS.subTitle:e.has(oe.ALBUMS.subTitle)&&oe.ALBUMS.subTitle,a=e.get(i);let o,n;switch(t){case oe.HOME.path:case oe.SONGS.path:o=j`<app-song-list filtername="${i||""}" filtervalue="${a}" .data="${Dt.songData}"></app-song-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.UPLOAD,le.SEARCH]}"></app-action>`;break;case oe.PLAYLIST.path:o=j`<app-song-list id="${e.get("id")}" .fetchData="${()=>(async t=>{const e=await jt(`/playlist/${t}/songs`);e.list=e.songs.map(t=>(_t.set(t.id,t),t.id)),delete e.songs,Ut.set(t,e),Q(Dt.playlistData,{})})(wt.location.query.get("id"))}" .data="${Dt.playlistData}"></app-song-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.UPLOAD,le.SEARCH]}"></app-action>`;break;case oe.FAVORITES.path:o=j`<app-song-list .fetchData="${qt}" .data="${Dt.favoriteData}"></app-song-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.UPLOAD,le.SEARCH]}"></app-action>`;break;case oe.SEARCH.path:o=j`<app-song-list .data="${Dt.searchData}"></app-song-list>`,n=j`<app-action .actions="${[le.BACK,le.SEARCH_INPUT]}"></app-action>`;break;case oe.ALBUMS.path:o=j`<app-album-list .fetchData="${Ei}" .data="${Dt.albumData}"></app-album-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.UPLOAD,le.SEARCH]}"></app-action>`;break;case oe.ARTISTS.path:o=j`<app-artist-list .fetchData="${Hi}" .data="${Dt.artistData}"></app-artist-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.UPLOAD,le.SEARCH]}"></app-action>`;break;case oe.PLAYLISTS.path:o=j`<app-playlist-list .fetchData="${Xt}" .data="${Dt.playlistData}"></app-playlist-list>`,n=j`<app-action .actions="${[le.MENU,le.TITLE,le.ADD_PLAYLIST,le.SEARCH]}"></app-action>`;break;default:o=j`<app-notfound></app-notfound>`,n=j`<app-action .actions="${B.isPhone?[le.MENU,le.TITLE]:[]}"></app-action>`}return j`<style>:host{flex-grow:1;display:flex;flex-direction:column;padding:var(--list-padding) var(--list-padding) 0 calc(var(--drawer-width) + var(--list-padding));background:linear-gradient(to top,var(--list-background-color),var(--list-background-light-color));color:var(--list-text-primary-color);fill:var(--list-text-primary-color);overflow:auto;scrollbar-width:thin;scrollbar-color:var(--scrollbar-color) var(--scrollbar-track-color)}:host::after{content:'';display:block;height:var(--list-padding);flex-shrink:0}.wrap{flex-shrink:0;flex-grow:1;display:flex;flex-direction:column;width:100%;max-width:86rem;margin:0 auto;box-sizing:border-box}@media ${B.PHONE}{:host{margin-bottom:var(--player-height)}}@media ${B.PHONE_LANDSCAPE},${B.PHONE},${B.TABLET}{:host{padding:var(--list-padding) var(--list-padding) 0}:host::-webkit-scrollbar{width:0}:host{scrollbar-width:none}}</style><div class="wrap">${n} ${o}</div>`}},Ti(Ai,"observedStores",[wt.historyState]),Oi));var Ni,Li;i(0);function Ii(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}customElements.define("app-title",(Li=Ni=class extends dt{constructor(...t){super(...t),Ii(this,"routeMap",Object.values(oe))}render(){const{list:t,currentIndex:e}=wt.historyState,{path:i,title:a}=t[e],o=this.routeMap.find(({path:t})=>t===i);return document.title=ce(a||o&&o.title||oe.HOME.title),this.hidden?"":document.title}},Ii(Ni,"observedStores",[wt.historyState]),Li));const Mi=3e3,zi=Object.assign({},Dt.toastState),Ci=[];let Di=0;class ji extends pt{static open(t){Q(Dt.toastState,t),setTimeout(()=>{Q(Dt.toastState,zi)},Mi)}preprocess(){const{text:t}=Dt.toastState,{list:e}=Dt.uploaderState;if(e.length?Di=e.length:Di&&(Di="uploaded",setTimeout(()=>{Di=0,this.update()},Mi)),t){const e=Ci.findIndex(({text:e})=>e===t);if(e>-1){const t=Ci[e];clearTimeout(t.timer),Ci.splice(e,1)}Ci.push({text:t,timer:setTimeout(()=>{Ci.splice(Ci.findIndex(({text:e})=>e===t),1),this.update()},Mi)})}}render(){if(this.preprocess(),!Ci.length&&!Di)return j``;const{errorList:t}=Dt.uploaderState;return j`<style>:host{z-index:9;position:fixed;left:1.6rem;bottom:calc(1.6rem + var(--player-height));display:flex;flex-direction:column;color:var(--toast-text-color);font-size:1.4rem}div{min-width:20em;padding:.6em;border:1px solid var(--toast-border-color);background:var(--toast-background-color)}div:not(:last-of-type){margin-bottom:.6em}</style>${Ci.map(({text:t})=>j`
            <div>${t}</div>
          `)}<div ?hidden="${!Di}">${"uploaded"===Di?`upload compelete: failure ${t.length}`:`${Di} songs are being uploaded...`}</div>`}}!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(ji,"observedStores",[Dt.toastState,Dt.uploaderState]),customElements.define("app-toast",ji),window.addEventListener("load",()=>{"paintWorklet"in CSS&&CSS.paintWorklet.addModule("paintworklet.js"),"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js")}),window.onerror=null}]);
//# sourceMappingURL=index.8742026ce6456a0e340f.js.map